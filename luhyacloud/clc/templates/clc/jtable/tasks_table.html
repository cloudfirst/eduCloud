{% extends "clc/jtable/template.html" %}
{% load i18n %}

{% block myfilter %}
<div class="filtering">
    <form>
        <p>
            {% trans "Instance ID" %}:<input type="text"  id="tinsid" />
            {% trans "Owner" %}:<input type="text" id="owner" />
            {% trans "Cluster IP" %}:<input type="text" id="ccip" />
            {% trans "Node IP" %}:<input type="text" id="ncip" />
           <button type="submit" id="LoadRecordsButton">{% trans "Filter Tasks" %}</button>
        </p>
    </form>
</div>
<p></p>
{% endblock %}

{% block myjs %}
<script type="text/javascript">

    $(document).ready(function () {

        $('#myjtable').jtable({
            jqueryuiTheme: true,

            // title: '{% trans "Tasks List',

            selecting: true, //Enable selecting
            multiselect: true, //Allow multiple selecting
            selectingCheckboxes: true, //Show checkboxes on first column

            sorting: true, //Enable sorting
            defaultSorting: 'Name ASC', //Set default sorting

            actions: {
                listAction:   '/clc/api/1.0/tasks/list',
                // deleteAction: '/clc/api/1.0/tasks/delete',
                updateAction: '/clc/api/1.0/tasks/update',
                // createAction: '/clc/api/1.0/tasks/create'
            },
            fields: {
                id: {
                    key: true,
                    edit: false,
                    create: false,
                    list: false,
                },
                tid: {
                    edit: false,
                    create: false,
                    list: false,
                },
                srcimgid: {
                    title: '{% trans "Source ImageID" %}',
                    width: '10%',
                    edit: false,
                },
                dstimgid: {
                    title: '{% trans "Destine ImageID" %}',
                    width: '10%',
                    edit: false,
                },
                insid: {
                    title: '{% trans "Instance ID" %}',
                    width: '10%',
                    edit: false,
                },
                user: {
                    title: '{% trans "Owner" %}',
                    width: '10%',
                    edit: false,
                },
                phase: {
                    title: '{% trans "Current Phase" %}',
                    width: '10%',
                    edit: false,
                },
                state: {
                    title: '{% trans "VM State" %}',
                    width: '10%',
                    edit: true,
                },
                ccip: {
                    title: '{% trans "Cluster IP" %}',
                    width: '10%',
                    edit: false,
                },
                ncip: {
                    title: '{% trans "Node IP" %}',
                    width: '10%',
                    edit: false,
                },
                completed: {
                    title: '{% trans "Completed" %}',
                    width: '10%',
                    list:  false,
                    edit: false,
                },
            },
            //Register to selectionChanged event to hanlde events
            selectionChanged: function () {
                window.parent.taksids_clear();

                //Get all selected rows
                var $selectedRows = $('#myjtable').jtable('selectedRows');

                if ($selectedRows.length > 0) {
                    $selectedRows.each(function () {
                        //Show selected rows
                        var record = $(this).data('record');
                        window.parent.taskSelected(record.tid);
                    });
                } else {
                    //No rows selected
                    window.parent.taskSelected(null);
                    //alert("no images selected!");
                }
            },
        });

        //Re-load records when user click 'load records' button.
        $('#LoadRecordsButton').click(function (e) {
            e.preventDefault();

            $('#myjtable').jtable('load', {
                tinsid: $("#tinsid").val(),
                owner: $("#owner").val(),
                ccip:  $("#ccip").val(),
                ncip:  $("#ncip").val(),
            });
        });

        //Load all records when page is first shown
        $('#LoadRecordsButton').click();

        //Load student list from server
        //$('#myjtable').jtable('load');
    });

</script>
{% endblock %}
