{% extends "clc/form/form.html" %}
{% load i18n %}

{% block myjavascript %}
<script type="text/javascript">
    var userid;
    var displayname;
    var password1;
    var password2;
    var role;
    var pds;
    var sds;
    var email;
    var phone;
    var desc;
    var errormsg;

    function submit_resources() {
        userid = $('#userid').val();
        displayname = $('#displayname').val();
        password1  = $('#password1').val();
        password2  = $('#password2').val();
        role = $('#role_list').val();
        pds = $('#data_size').val();
        r1 = $('#optionsRadios1').is(':checked');
        if (r1 == true) {
            sds = $('#optionsRadios1').val();
        } else {
            sds = $('#optionsRadios2').val();
        }
        email = $('#email').val();
        phone = $('#phone').val();
        desc  = $('#desc').val();

        if (verification() == true) {
            url = "/clc/api/1.0/account/create";
            postdata = {
                userid:         userid,
                displayname:    displayname,
                password:       password1,
                role:           role,
                pds:            pds,
                sds:            sds,
                email:          email,
                phone:          phone,
                desc:           desc,
            }

            $.post(url, postdata, function(data) {
                var items = [];
                $.each(data, function (key, val) {
                    items[key] = val;
                });
                if (items['Result'] == "OK") {
                    $('.alert-success').css('display', 'block');
                    $('.alert-danger').css( 'display', 'none');
                    $('.btn').addClass('disabled');
                } else {
                    $('.alert-success').css('display', 'none');
                    $('.alert-danger').text(items['errormsg']);
                    $('.alert-danger').css( 'display', 'block');
                }
            });
        } else {
            $('.alert-success').css('display', 'none');
            $('.alert-danger').css( 'display', 'block');
        }
    }

    function add_new_role() {
        next = $('#next').text();
        el = '<div class="well well-sm">\
                  <div class="form-group"> \
                        <label>Allocated Role: </label> \
                        <select id="perm' + next + '" class="form-control-inline"> \
                            <option value=""></option> \
                            {% for role in roles %} \
                            <option value="{{ role.value }}">{{ role.name }}</option> \
                            {% endfor %} \
                        </select> \
                   </div> \
                   <div class="form-group" id="checkbox_perm' + next + '"> \
                        <label>Access Contorl: </label> \
                        <label class="checkbox-inline"> \
                            <input type="checkbox">Read \
                        </label> \
                        <label class="checkbox-inline"> \
                            <input type="checkbox">Write \
                        </label> \
                        <label class="checkbox-inline"> \
                            <input type="checkbox">Execute \
                        </label> \
                        <label class="checkbox-inline"> \
                            <input type="checkbox">Create\
                        </label>\
                        <label class="checkbox-inline">\
                            <input type="checkbox">Delete\
                        </label>\
                    </div>\
              </div>';
        $('#mysubmit').before(el);
        $('#next').text(parseInt(next) + 1);
    }

    function init_data() {

        {% for perm in perms %}
        $('#{{ perm.id}}' ).val('{{ perm.role_value}}')
        {% endfor%}
    }

    $(document).ready(function () {
        $("#mysubmit").click(function(){
            submit_resources();
        });

        $("#add").click(function(){
            add_new_role();
        });

        init_data();

    });
</script>
{% endblock %}

{% block myform %}
<div class="row">
<div class="col-lg-12">
<div class="panel panel-default">
<div class="panel-heading">
    <h2>{{ res }} Permission Configuration</h2>
</div>
<div class="panel-body">
    <div class="row">
        <div class="col-lg-9">
            <!-- /.col-lg-6 (nested) -->
            <div class="col-lg-9">
                <div role="form" id="myform">
                    <div id="next" style="display:none">{{ next }}</div>
                    {% for perm in perms %}
                    <div class="well well-sm">
                        <div class="form-group">
                            <label>Allocated Role: </label>
                            <select id="{{ perm.id }}" class="form-control-inline">
                                <option value=""></option>
                                {% for role in roles %}
                                <option value="{{ role.value }}">{{ role.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group" id="checkbox_{{ perm.id  }}">
                            <label>Access Contorl: </label>
                            <label class="checkbox-inline">
                                {% if perm.read == 1 %}
                                <input type="checkbox" checked="checked">Read
                                {% else %}
                                <input type="checkbox">Read
                                {% endif %}
                            </label>
                            <label class="checkbox-inline">
                                {% if perm.write == 1 %}
                                <input type="checkbox" checked="checked">Write
                                {% else %}
                                <input type="checkbox">Write
                                {% endif %}
                            </label>
                            <label class="checkbox-inline">
                                {% if perm.execute == 1 %}
                                <input type="checkbox" checked="checked">Execute
                                {% else %}
                                <input type="checkbox">Execute
                                {% endif %}
                            </label>
                            <label class="checkbox-inline">
                                {% if perm.create == 1 %}
                                <input type="checkbox" checked="checked">Create
                                {% else %}
                                <input type="checkbox">Create
                                {% endif %}
                            </label>
                            <label class="checkbox-inline">
                                {% if perm.delete == 1 %}
                                <input type="checkbox" checked="checked">Delete
                                {% else %}
                                <input type="checkbox">Delete
                                {% endif %}
                            </label>
                        </div>
                    </div>
                    {% endfor %}

                    <button id="mysubmit" type="submit" class="btn btn-primary">Submit Button</button>
                    <button id="add"      class="btn btn-default">Add Permission</button>
                </div>
                <p></p>
                <div class="alert alert-success" style="display: none">
                      New Account is created Successfully.
                </div>
                <div class="alert alert-danger" style="display: none">
                      Create new account Failed, try again.
                </div>
        </div>
        <!-- /.col-lg-6 (nested) -->
    </div>
    <!-- /.row (nested) -->
</div>
<!-- /.panel-body -->
</div>
<!-- /.panel -->
</div>
<!-- /.col-lg-12 -->
</div>
{% endblock %}
